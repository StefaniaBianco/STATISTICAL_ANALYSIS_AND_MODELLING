getwd()
df <- read.csv("/Users/mattiafabris/Desktop/unibo/statistical analysis/Progetto.def/20221213_QDV2022_001 .csv", dec=".", sep=",", stringsAsFactors = T)
df

Piste_ciclabili<-df[df$INDICATORE=="Piste ciclabili", c(1,3,5)]
Piste_ciclabili<-Piste_ciclabili[order(Piste_ciclabili$CODICE.PROVINCIA.ISTAT..STORICO.),]

Tasso_motorizzazione<-df[df$INDICATORE=="Tasso di motorizzazione",c(1,3,5)]
Tasso_motorizzazione<-Tasso_motorizzazione[order(Tasso_motorizzazione$CODICE.PROVINCIA.ISTAT..STORICO.),]

Verde_urbano<-df[df$INDICATORE=="Verde urbano fruibile",c(1,3,5)]
Verde_urbano<-Verde_urbano[order(Verde_urbano$CODICE.PROVINCIA.ISTAT..STORICO.),]

Qualità_aria<-df[df$INDICATORE=="Qualità dell'aria",c(1,3,5)]
Qualità_aria<-Qualità_aria[order(Qualità_aria$CODICE.PROVINCIA.ISTAT..STORICO.),]

Isole_pedonali <-df[df$INDICATORE=="Isole pedonali ",c(1,3,5)]
Isole_pedonali<-Isole_pedonali[order(Isole_pedonali$CODICE.PROVINCIA.ISTAT..STORICO.),]

Ecosistema_urbano <- df[df$INDICATORE=="Ecosistema urbano ", c(1,3,5)]
Ecosistema_urbano <- Ecosistema_urbano[order(Ecosistema_urbano$CODICE.PROVINCIA.ISTAT..STORICO.),]

newdf<-data.frame(Piste_ciclabili[,c(1,2,3)], Tasso_motorizzazione[,3], Verde_urbano[,3], Qualità_aria[,3], Isole_pedonali[,3], Ecosistema_urbano[,3])
newdf

names(newdf) <- c("Province", "Province code", "Cycling lanes", "Motorization rate", 
                  "Urban green", "Air quality", 
                  "Pedestrian areas", "Urban ecosystem")
names(newdf)

#separazione dell'italia https://www.tuttitalia.it/statistiche/nord-centro-mezzogiorno-italia/

Nord <- newdf[c(1:40, 93, 96:99, 103:104),]
Nord

Centro <- newdf[c(41:60, 100, 105),]
Centro

Mezzogiorno <- newdf[c(61:92, 94:95, 101:102, 106:107),]
Mezzogiorno

nrow(Nord)
nrow(Centro)
nrow(Mezzogiorno)

mean(newdf$`Cycling lanes`)
mean(Nord$`Cycling lanes`)
mean(Centro$`Cycling lanes`)
mean(Mezzogiorno$`Cycling lanes`)
mean_cycling_lanes_values<-c(9.67, 14.90, 7.10, 4.70)

mean(newdf$`Motorization rate`)
mean(Nord$`Motorization rate`)
mean(Centro$`Motorization rate`)
mean(Mezzogiorno$`Motorization rate`)

mean(Nord$`Urban green`)
mean(Centro$`Urban green`)
mean(Mezzogiorno$`Urban green`)

mean(Nord$`Air quality`)
mean(Centro$`Air quality`)
mean(Mezzogiorno$`Air quality`)

mean(Nord$`Pedestrian areas`)
mean(Centro$`Pedestrian areas`)
mean(Mezzogiorno$`Pedestrian areas`)

mean(newdf$`Urban ecosystem`)
mean(Nord$`Urban ecosystem`)
mean(Centro$`Urban ecosystem`)
mean(Mezzogiorno$`Urban ecosystem`)

# Mean of variable "Urban green"
mean_urban_green<-mean(newdf$`Urban green`)
mean_urban_green
mean_urban_green_nord<-mean(Nord$`Urban green`)
mean_urban_green_nord
mean_urban_green_centro<-mean(Centro$`Urban green`)
mean_urban_green_centro
mean_urban_green_mezzogiorno<-mean(Mezzogiorno$`Urban green`)
mean_urban_green_mezzogiorno
mean_urban_green_values<-c(22.40, 29.79, 19.87, 14.74)
# Median of variable "Urban green"
median_urban_green<-median(newdf$`Urban green`)
# Variance of variable "Urban green" // var=M(x^2)-M(x)^2
variance_urban_green<-mean(newdf$`Urban green`^2)-(mean_urban_green)^2
variance_urban_green
variance_urban_green_nord<-mean(Nord$`Urban green`^2)- (mean_urban_green_nord)^2
variance_urban_green_nord
variance_urban_green_centro<-mean(Centro$`Urban green`^2)-(mean_urban_green_centro)^2
variance_urban_green_centro
variance_urban_green_mezzogiorno<-mean(Mezzogiorno$`Urban green`^2)- (mean_urban_green_mezzogiorno)^2
variance_urban_green_mezzogiorno

#standard deviation of variable "Urban green" // sd=sqrt(var)
sd_urban_green<-sqrt(variance_urban_green)
sd_urban_green
sd_urban_green_nord<-sqrt(variance_urban_green_nord)
sd_urban_green_nord
sd_urban_green_centro<-sqrt(variance_urban_green_centro)
sd_urban_green_centro
sd_urban_green_mezzogiorno<-sqrt(variance_urban_green_mezzogiorno)
sd_urban_green_mezzogiorno

#coefficient of variation of variable "Urban green" // cv=sd/mean
cv_urban_green<-sd_urban_green/mean_urban_green
cv_urban_green
cv_urban_green_nord<-sd_urban_green_nord/mean_urban_green_nord
cv_urban_green_nord
cv_urban_green_centro<-sd_urban_green_centro/mean_urban_green_centro
cv_urban_green_centro
cv_urban_green_mezzogiorno<-sd_urban_green_mezzogiorno/mean_urban_green_mezzogiorno
cv_urban_green_mezzogiorno

#barplot with the mean of variable "Urban green"
bp_mean_urban_green<-barplot(mean_urban_green_values, 
                                 names.arg = c("Italy", "North", "Centre", "South"), 
                                 col="light green", ylab="m^2 per inhabitant")
title("Barplot of Urban green")
abline(h=22.40)

# boxplot 
par(mfrow=c(1,2))
boxplot(newdf$`Urban green`, main = "Boxplot of Urban green", ylab = "m^2 per inhabitant", outline = FALSE)
boxplot(newdf$`Urban green`, main = "Boxplot of Urban green", ylab = "m^2 per inhabitant")
# Mean of variable "Air quality"
mean_air_quality<-mean(newdf$`Air quality`)
mean_air_quality
mean_air_quality_nord<-mean(Nord$`Air quality`)
mean_air_quality_nord
mean_air_quality_centro<-mean(Centro$`Air quality`)
mean_air_quality_centro
mean_air_quality_mezzogiorno<-mean(Mezzogiorno$`Air quality`)
mean_air_quality_mezzogiorno
mean_air_quality_values<-c(51.32, 62.41, 43.83, 41.95)

#boxplot of "Air quality"
boxplot(newdf$`Air quality`, main = "Boxplot of Air quality", ylab = "Index based on PM10, NO2 and O3 data", ylim=c(10,90))

# Variance of variable "Air quality" // var=M(x^2)-M(x)^2
variance_air_quality<-mean(newdf$`Air quality`^2)-(mean_air_quality)^2
variance_air_quality
variance_air_quality_nord<-mean(Nord$`Air quality`^2)- (mean_air_quality_nord)^2
variance_air_quality_nord
variance_air_quality_centro<-mean(Centro$`Air quality`^2)-(mean_air_quality_centro)^2
variance_air_quality_centro
variance_air_quality_mezzogiorno<-mean(Mezzogiorno$`Air quality`^2)- (mean_air_quality_mezzogiorno)^2
variance_air_quality_mezzogiorno

#standard deviation of variable "Air quality" // sd=sqrt(var)
sd_air_quality<-sqrt(variance_air_quality)
sd_air_quality
sd_air_quality_nord<-sqrt(variance_air_quality_nord)
sd_air_quality_nord
sd_air_quality_centro<-sqrt(variance_air_quality_centro)
sd_air_quality_centro
sd_air_quality_mezzogiorno<-sqrt(variance_air_quality_mezzogiorno)
sd_air_quality_mezzogiorno

#coefficient of variation of variable "Air quality" // cv=sd/mean
cv_air_quality<-sd_air_quality/mean_air_quality
cv_air_quality
cv_air_quality_nord<-sd_air_quality_nord/mean_air_quality_nord
cv_air_quality_nord
cv_air_quality_centro<-sd_air_quality_centro/mean_air_quality_centro
cv_air_quality_centro
cv_air_quality_mezzogiorno<-sd_air_quality_mezzogiorno/mean_air_quality_mezzogiorno
cv_air_quality_mezzogiorno
#barplot with the mean of variable "Air quality"
bp_mean_air_quality<-barplot(mean_air_quality_values, 
                                 names.arg = c("Italy", "North", "Centre", "South"), 
                                 col="light green", ylab="Index based on PM10, NO2 and O3 data")
title("Barplot of Air quality")
abline(h=51.32)
dev.off()
# correlation between motorization rate and cycling lanes                          
# Plot to see if there is correlation
plot(x=newdf$`Urban green`, y=newdf$`Air quality`,    
     xlab = "Urban Green", ylab="Air quality", 
     main="Scatterplot of Urban Green and Air quality", 
     cex.main=1.4, font.main=2, 
     col.main="orange")
abline(model_italy)
cor(newdf$`Urban green`, newdf$`Air quality`) #cor=0.13    
cor.test(newdf$`Urban green`, newdf$`Air quality`) #p-value=0.17-->no evidence against H0=true correlation is equal to 0
model_italy <- lm(newdf$`Urban green`~ newdf$`Air quality`)
summary(model_italy)
# different areas of Italy
plot(x=Nord$`Motorization rate`, y=Nord$`Cycling lanes`)
cor(x=Nord$`Motorization rate`, y=Nord$`Cycling lanes`) #value 0.32, poor correlation

plot(x=Centro$`Motorization rate`, y=Centro$`Cycling lanes`)
cor(x=Centro$`Motorization rate`, y=Centro$`Cycling lanes`)  #-0.05, no correlation

plot(x=Mezzogiorno$`Motorization rate`, y=Mezzogiorno$`Cycling lanes`)
cor(x=Mezzogiorno$`Motorization rate`, y=Mezzogiorno$`Cycling lanes`) #-0.01 good negative correlation

model_mot_cyc<-lm(formula = newdf$`Motorization rate` ~ newdf$`Cycling lanes`)
summary(model_mot_cyc)

# grouped frequency distribution of the variable Air quality 
range(newdf$`Air quality`)

air_quality_rate_cat<-cut(newdf$`Air quality`, breaks = c(20, 34, 48, 62, 76, 90), labels = c("20-34", "34-48", "48-62","62-76", "76-90"))
table(air_quality_rate_cat)

air_quality_rate_cat_nord<-cut(Nord$`Air quality`, breaks = c(20, 34, 48, 62, 76, 90), labels = c("20-34", "34-48", "48-62","62-76", "76-90"))
table(air_quality_rate_cat_nord)

air_quality_rate_cat_centro<-cut(Centro$`Air quality`, breaks = c(20, 34, 48, 62, 76, 90), labels = c("20-34", "34-48", "48-62","62-76", "76-90"))
table(air_quality_rate_cat_centro)

air_quality_rate_cat_sud<-cut(Mezzogiorno$`Air quality`, breaks = c(20, 34, 48, 62, 76, 90), labels = c("20-34", "34-48", "48-62","62-76", "76-90"))
table(air_quality_rate_cat_sud)

library(RColorBrewer)
coul <- brewer.pal(5, "Set2")

par(mfrow=c(2,2))
barplot(table(air_quality_rate_cat), xlab="Index on Pm10, nitrogen dioxide and ozone data", ylab="Absolute frequency", ylim = c(0,50), main="Air quality Italy", col=coul, border="black")
barplot(table(air_quality_rate_cat_nord), xlab="Index on Pm10, nitrogen dioxide and ozone data", ylab="Absolute frequency", ylim = c(0,25), main="Air quality North Italy", col=coul, border="black")
barplot(table(air_quality_rate_cat_centro), xlab="Index on Pm10, nitrogen dioxide and ozone data", ylab="Absolute frequency", ylim = c(0,25), main="Air quality Centre Italy", col=coul, border="black")
barplot(table(air_quality_rate_cat_sud), xlab="Index on Pm10, nitrogen dioxide and ozone data", ylab="Absolute frequency", ylim = c(0,25), main="Air quality South Italy", col=coul, border="black")
dev.off()
hist(newdf$`Air quality`, freq=F, xlab="Index on Pm10, nitrogen dioxide and ozone data", ylab="Number of cities", main="Air quality Italy", col=coul, border="black")
lines(density(newdf$`Air quality`), lwd=2)
abline(v=mean(newdf$`Air quality`), col='red', lwd=3)

curve(dnorm(x, mean=mean(newdf$`Air quality`), 
            sd=sd(newdf$`Air quality`)), 
      add=T, col="orange", lwd=2)
shapiro.test(newdf$`Air quality`)

#t test between population means for urban green
t.test(x=Nord$`Urban green` , y = Mezzogiorno$`Urban green`, alternative = "two.sided",
       mu=0, var.equal=T, conf.level = 0.99)
t.test(x=Nord$`Urban green`, y = Centro$`Urban green`, alternative = "two.sided",
       mu=0, var.equal=T, conf.level = 0.99)
t.test(x=Mezzogiorno$`Urban green`, y = Centro$`Urban green`, alternative = "two.sided",
       mu=0, var.equal=T, conf.level = 0.99)

t.test(x=Nord$`Air quality` , y = Mezzogiorno$`Air quality`, alternative = "two.sided",
       mu=0, var.equal=T, conf.level = 0.99)
t.test(x=Nord$`Air quality`, y = Centro$`Air quality`, alternative = "two.sided",
       mu=0, var.equal=T, conf.level = 0.99)
t.test(x=Mezzogiorno$`Air quality`, y = Centro$`Air quality`, alternative = "two.sided",
       mu=0, var.equal=T, conf.level = 0.99)



############################ REPORT

As a first numerical measure we decided to summarize the data calculating the arithmetic mean for each indicator in different areas. 
For exemple for the indicator "Urban green" we did:
```{r, eval=FALSE }
mean_urban_green<-mean(newdf$`Urban green`)
mean_urban_green_nord<-mean(Nord$`Urban green`)
mean_urban_green_centro<-mean(Centro$`Urban green`)
mean_urban_green_mezzogiorno<-mean(Mezzogiorno$`Urban green`)
```
Having this results:
```{r, eval=TRUE }
mean_urban_green<-mean(newdf$`Urban green`)
mean_urban_green_nord<-mean(Nord$`Urban green`)
mean_urban_green_centro<-mean(Centro$`Urban green`)
mean_urban_green_mezzogiorno<-mean(Mezzogiorno$`Urban green`)
```
As we can see values are different, with a mean higher in the north than the centre and the south.
